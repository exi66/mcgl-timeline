<!doctype html>
<html lang="ru">
  <head>
    <title>История Галактики</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <script src="./js/timeline.js"></script>
    <link rel="icon" type="image/x-icon" href="./favicon.ico" />
    <style>
      .clan-list {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-left: auto;
        margin-right: auto;
        text-align: center;
      }
      a {
        line-height: 0;
      }
      .clan-icon {
        height: 34px;
        width: 22px;
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
        background: rgb(0%, 0%, 0%, 30%);
      }
      html,
      body {
        width: 100%;
        height: 100%;
        padding: 0px;
        margin: 0px;
        background: rgb(22, 20, 20);
        font-size: 16px;
        font-family: Arial, Helvetica, sans-serif;
      }
      #timeline-embed {
        height: 100%;
      }
      .tl-timeline a {
        color: #666 !important;
        text-decoration: underline !important;
        transition: color 0.15s ease-in-out;
      }
      .tl-timeline a:hover {
        color: black !important;
        text-decoration: underline !important;
      }
      .f4 {
        font-size: 1.5rem !important;
      }
      button.tl-slidenav-next {
        transition: all 0.15s ease-in-out;
      }
      button.tl-slidenav-prev {
        transition: all 0.15s ease-in-out;
      }
    </style>
    <style>
      .search-container {
        position: fixed;
        top: 1.25rem;
        right: 1.25rem;
        display: flex;
        align-items: center;
        height: 3.125rem;
        width: 3.125rem;
        background-color: white;
        border-radius: 9999px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
      }

      .search-container.active {
        width: 18.75rem;
      }

      .search-input {
        width: 0;
        height: 100%;
        border: none;
        outline: none;
        padding: 0;
        transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0;
      }

      .search-container.active .search-input {
        width: 100%;
        padding: 0 1rem 0 1.25rem;
        opacity: 1;
      }

      .search-btn {
        min-width: 3.125rem;
        height: 3.125rem;
        background: black;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        transition: background-color 0.15s ease-in-out;
      }

      .search-btn:hover {
        background-color: #181818;
      }

      .search-btn svg {
        width: 1.25rem;
        height: 1.25rem;
        fill: none;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }
    </style>
  </head>

  <body>
    <div class="search-container" id="searchWrapper">
      <button class="search-btn" id="searchBtn" title="Поиск">
        <svg viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
      <input
        type="text"
        class="search-input"
        placeholder="Поиск..."
        id="searchInput"
      />
    </div>
    <div id="timeline-embed">
      <noscript
        >Для просмотра содержимого страницы необходимо включить javascript или
        вы можете ознакомится с данными в
        <a
          href="https://docs.google.com/spreadsheets/d/1mNB1OUyZsV59dRhcatl3h0CZpMJFRK2qMRfI9FBTabk/pubhtml"
          target="_blank"
          >формате таблицы</a
        >
      </noscript>
    </div>
    <script>
      window.onload = function () {
        const searchWrapper = document.getElementById("searchWrapper");
        const searchBtn = document.getElementById("searchBtn");
        const searchInput = document.getElementById("searchInput");

        function openSearch() {
          searchWrapper.classList.add("active");
          setTimeout(() => searchInput.focus(), 100);
        }

        searchBtn.addEventListener("click", (e) => {
          if (searchWrapper.classList.contains("active")) {
            searchWrapper.classList.remove("active");
          } else {
            openSearch();
          }
          e.stopPropagation();
        });

        document.addEventListener("click", (e) => {
          if (!searchWrapper.contains(e.target)) {
            searchWrapper.classList.remove("active");
          }
        });

        searchInput.addEventListener("input", (e) => {
          const text = e.target.value;
          if (text.length > 0) {
            const events = timeline.config.events;
            const results = events.filter(
              (event) =>
                event.text.headline
                  .toLowerCase()
                  .includes(text.toLowerCase()) ||
                event.text.text.toLowerCase().includes(text.toLowerCase()),
            );
            if (results.length > 0 && timeline) {
              const firstEvent = results[0];
              timeline?.goToId(firstEvent.unique_id);
              timeline?._updateHashBookmark(firstEvent.unique_id);
            }
          }
        });

        window.addEventListener("keydown", (e) => {
          if ((e.ctrlKey || e.metaKey) && e.code === "KeyF") {
            e.preventDefault();
            openSearch();
          }

          if (e.key === "Escape") {
            searchWrapper.classList.remove("active");
            searchInput.blur();
          }
        });

        const libPath = "js";

        const additionalOptions = {
          language: "ru",
          initial_zoom: 4,
          duration: 150,
          font: "ubuntu",
          theme: "contrast",
          hash_bookmark: true,
          script_path: `${document.location.href.substring(
            0,
            document.location.href.lastIndexOf("/"),
          )}/${libPath}/`,
          sheets_proxy: null,
        };
        const timeline = new TL.Timeline(
          "timeline-embed",
          "https://docs.google.com/spreadsheets/d/1mNB1OUyZsV59dRhcatl3h0CZpMJFRK2qMRfI9FBTabk/pubhtml",
          additionalOptions,
        );
      };
    </script>
  </body>
</html>
